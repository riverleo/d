---
title: "리팩토링할 때 버려야 할 아까운 것들"
date: 2018-10-05T14:09:34+09:00
draft: true
---

코드에 대한 애착이 많은 개발자들은 하루에도 몇 번씩 코드를 뜯어 고치고 싶은 충동에 휩싸일 때가 있습니다.
작게는 수십 줄의 중복된 코드 조각을 모으는 일부터 크게는 새로운 프레임워크와 개발 환경을 도입하는 일까지
좋은 코드에 대한 욕심은 때로 끝이 없는 것 같습니다.  

개인적으로 **리팩토링은 작은 보상을 감수하고 기존의 구조를 보다 나은 방향으로 개선하고자 하는 선의**라고
생각합니다. 하지만 이런 좋은 의도와 반대로 리팩토링은 종종 새로운 복잡성을 만들어 내기도 하고 정상적으로
동작하는 기능을 마비시키기도 하죠. 좋은 의도로 시작했던 리팩토링이 잘못된 방향으로 흘러가는 것을 느낄 때
개발자는 큰 상실감을 겪습니다.

그렇기 때문에 리팩토링은 좋은 의도도 중요하지만 무엇보다 제대로 마무리하려는 자세가 중요한 작업 같습니다.
욕심 부리기보다는 올바른 목표와 방법으로 접근하고 사람들에게 분명한 개선점을 제시할 수 있어야 하죠. 다른
사람들의 의견을 수용할 때와 본인의 의견을 끝까지 관철시킬 수 있는 판단력과 객관성도 갖추어야 합니다.

## 버려야 할 것들

> 많은 사람에게 집중이란 집중할 것에 ‘예스’하는 것을 의미합니다. 하지만 집중이란 좋은 아이디어 수백 개에
> ‘노’라고 말하는 것입니다. 조심스럽게 골라야 합니다. - 스티브 잡스, 1997년 WWDC에서

#### 나만 아는 코드

오랜 시간을 투자해 리팩토링한 코드를 협업하는 개발자들이 이해하기 어려워 한다면 진행방식에 문제가 있다는
신호입니다. 많은 개발자들이 불필요하다는 이유로 진행과정에서 리뷰와 공유 그리고 문서화를 생략하는 경우가
많은데 이럴 때에는 처음 리팩토링을 하는지 그 이유를 곰곰히 잘 생각해 봅시다. 다른 누군가가 짜놓은
코드를 보고 왜 이렇게 짜는지 이해가 안가서 짠 경우가 많지요? 그러니까 공유와 논의 과정이 생략된 리팩토링은
그저 기존의 코드를 내가 좋아하는 방식으로 다시 작성하는 작업에 불과합니다.

리팩토링에서 가장 중요한 것은 코드를 재작성하는 것이 아니라 가독성을 높이고 확장성있게 재구성하는 것입니다.
기존과 다르게 새로운 구조를 도입하고 싶다면 우선 샘플 코드를 짜고 협업하는 개발자의 피드백을 받고 반영하는
과정으로 진행합니다.

읽기 쉬운 코드란 결국 내가 알고 있는 구조의 코드입니다. 익숙하지 않은 구조를 보고 단번에 읽기 쉽다고 말하는
개발자는 없습니다. 다들 분명 새로운 구조에 대해 뭔가 어색하다, 문제가 생길 것 같다는 뉘앙스의 말을 할텐데
부정적인 피드백에 너무 위축될 필요는 없습니다. 그리고 피드백을 모든 개발자들에게 받으려 할 필요도 없습니다.
실제로 나와 함께 코드를 공유하는 개발자와 합이 맞으면 그만입니다. 중요한 것은 생산성과 가독성입니다. 나와
함께 일하는 개발자가 그 구조를 이해하지 못한다면 생산성과 가독성 모두를 포기하는 것과 같은 행위입니다.

반대로 상대방이 리팩토링할 때 리뷰하는 개발자로서 좋은 자세는 상대방의 코드를 보고 그 순간에는 이해가 가지
않더라도 느낌으로 이야기하지 않고 직접 사용해보고 충분히 느낀 뒤에 피드백합니다.

#### 거대한 변화

거대한 변화를 줄 때에는 모두가 신중히 생각하고 결정해야 합니다. 큰 변화에는 오랜 기간이 걸리고 기존 동작들이
오동작할 가능성 또한 굉장히 큽니다. 개발 방식에도 큰 변화를 주기 때문에 모두가 신중히 결정해야 될 상황입니다.

이전에 일하던 회사에서 정말 대규모의 서버 포팅 작업을 진행했던 경험이 있습니다. 돌이켜 생각해보면 무려 일년
가까이 진행된 업무였죠. 포팅 기간 동안 회사의 비지니스 요구사항은 처리될 수 없었고 회사 성장은 그 기간 동안
정체될 수 밖에 없었습니다. 그렇다면 리팩토링을 통해 굉장히 큰 개선을 이루어냈느냐 말하면 그렇게 말하기도
어렵습니다. 일부의 개선이 있다 말할 수 있겠지만 회사의 성장을 일년 넘게 방치하면서 그 과정을 진행할 가치가
있었는지는 의문입니다.

물론 거대한 변화는 때때로 불가피하게 찾아옵니다. 하지만 당시 상황에서 안타까운 점은 그런 거대한 변화를 너무
쉽게 결정했다는 점입니다. 특히 기존에 코드를 작성하던 개발자들이 모두 떠나고 유지보수가 어려운 시점에서
이런 결정은 굉장히 쉽게 이루어집니다.

개발에서 배수의 진을 치고 나아가는 것은 결코 현명하지 않습니다. 적은 코드에 있지 않고 비지니스에 있습니다.
이런 거대한 변화를 진행할 때에는 다각도로 비지니스에 영향을 최소화 하기 위한 고민들을 하고 기존의 코드를
유지보수하는 것과 병행할 수 있도록 계획되어야 합니다.

#### 최신 라이브러리에 대한 맹신

개발에서는 매년 수십개의 새로운 프레임워크들이 만들어지고 생태계 안에서 작년까지 업계의 표준으로 받아들여졌던
프레임워크가 불과 몇달 만에 새로운 프레임워크로 대체되는 경우가 빈번합니다. 워낙 빠르게 변화하는 곳이다보니
개발자로써 새로운 기술을 익히는 일에 나태하게 몇년을 지내다 보면 새로운 환경에 도태되어 옛날 개발자로 취급받기
쉽죠.

최신 라이브러리를 사용하고 싶다면 개인 프로젝트에서 충분히 숙지하고 난 이후 적용하세요.

#### 신뢰할 수 없는 함수

사람은 본능적으로 자신이 이해할 수 없는 영역을 만났을 때 불안을 느낍니다. 그리고 개발에서 이런 불안을 없애는
가장 좋은 방법은 테스트 코드를 작성하는 것입니다. 많은 책과 글에서 리팩토링을 하기 앞서 결과에 대한 테스트
환경을 만들 것을 권장하고 있습니다. 테스트 과정없이 진행되는 리팩토링을 진정한 의미의 리팩토링이라 하기 어렵습니다.

#### 미래에 대한 과도한 염려

리팩토링을 할 때 지금 발생하는 이슈를 해결하는데만 집중하세요. 앞으로 이런 문제가 발생할 것을 대비하는 것은
자칫 불필요한 스펙을 추가해 코드를 더 어렵게 만듭니다.

## 챙겨야할 것들

#### 팀밸런스

회사에 개발자가 나 혼자라면 리팩토링에 대한 욕구를 최대한 참는 것이 좋습니다.

#### 복구에 대한 시나리오

규모가 큰 리팩토링을 적용할 때에는 반드시 복구 시나리오를 준비해야 합니다.

#### 코어 함수에 대한 테스트 코드 작성

최소한 공통으로 사용하는 함수나 컴포넌트에 대해서는 테스트 코드를 작성하는 것이 좋습니다.

#### 문서화

문서화를 좋아하는 개발자는 없습니다. 하지만 문서는 개발에 큰 도움이 됩니다.
